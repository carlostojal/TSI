<!DOCTYPE html>

<!--

    Copyright (c) Carlos Tojal (carlostojal)
    Foz do Arelho
    previsao/index.html
    github.com/carlostojal/TSI

-->

<!-- Previsão meteorológica -->

<html>
    <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
            <title> Weather Forecast - Foz do Arelho </title>
            <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway&display=swap">
            <link rel="stylesheet" href="../styles.css">
            <!-- Bootstrap -->
            <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
            <!-- Scripts JS relativos à meteorologia -->
            <script type="text/javascript" src="../scripts/weather.js"></script>
            <script type="text/javascript" src="../scripts/forecast.js"></script>
    </head>
    <body>
        <!-- Contém todo o cabeçalho da página -->
        <header>
            <div class="title_header">
                <!-- Título grande -->
                <h1 class="title"> Weather Forecast </h1>
                    
                <!-- Itens do menu -->
                <nav class="menu">
                    <a class="menu_items" href="../en"> HOME </a>
                    <a class="menu_items" href="../where-to-stay/"> WHERE TO STAY </a>
                    <a class="menu_items" href="../o-que-fazer"> WHAT TO DO </a>
                    <a class="menu_items" href="."> WEATHER FORECAST </a>
                    <a class="menu_items" href="../contatos"> CONTACTS </a>
                    <a class="menu_items" href="../previsao"> PT </a>
                </nav>
            </div>
        </header>
        <section>
            <div class="forecast_day" id="day1">Obtaining the weather forecast. Please wait.</div><br>
            <div class="forecast_day" id="day2">Obtaining the weather forecast. Please wait.</div><br>
            <div class="forecast_day" id="day3">Obtaining the weather forecast. Please wait.</div><br>
            <div class="forecast_day" id="day4">Obtaining the weather forecast. Please wait.</div><br>
            <div class="forecast_day" id="day5">Obtaining the weather forecast. Please wait.</div><br>
            <!-- Obtém previsão meteorológica da API OpenWeatherMap -->
            <script>
                var forecast = getForecastEn(); // obtém a previsão
                var date = new Date(forecast.list[0].dt_txt); // obtém a data da primeira previsão (data atual)
                day1 = date.getDate(); //obtém o dia da data
                // Declaração de variáveis
                var max_temps = new Array(5);
                var min_temps = new Array(5);
                var days = new Array(5);
                var details = new Array(5);
                var texts = new Array(5);
                // Inicialização de variáveis
                for(var i = 0; i < 5; i++) {
                    max_temps[i] = -100;
                    min_temps[i] = 100;
                    days[i] = 0;
                    details[i] = "";
                    texts[i] = "";
                }
                // Obtenção da temperatura máxima e mínima para cada dia 
                for(var i = 0; i < forecast.cnt; i++) {
                    date = new Date(forecast.list[i].dt_txt);
                    if(date.getDate() == day1) {
                        if(forecast.list[i].main.temp_max > max_temps[0])
                            max_temps[0] = forecast.list[i].main.temp_max;
                        if(forecast.list[i].main.temp_min < min_temps[0])
                            min_temps[0] = forecast.list[i].main.temp_min;
                        days[0] = new Date(forecast.list[i].dt_txt).getDay();
                        var hours = date.getHours();
                        var minutes = date.getMinutes();
                        if (hours <= 9)
                            hours = "0" + hours;
                        if (minutes <= 9)
                            minutes = "0" + minutes;
                        details[0] += hours + ":" + minutes + " - " + getForecastStatus(forecast.list[i]) + ", " + getForecastTemp(forecast.list[i]) + "°C<br>";
                    } else if(date.getDate() == (day1 + 1)) {
                        if(forecast.list[i].main.temp_max > max_temps[1])
                            max_temps[1] = forecast.list[i].main.temp_max;
                        if(forecast.list[i].main.temp_min < min_temps[1])
                            min_temps[1] = forecast.list[i].main.temp_min;
                        days[1] = new Date(forecast.list[i].dt_txt).getDay();
                        var hours = date.getHours();
                        var minutes = date.getMinutes();
                        if (hours <= 9)
                            hours = "0" + hours;
                        if (minutes <= 9)
                            minutes = "0" + minutes;
                        details[1] += hours + ":" + minutes + " - " + getForecastStatus(forecast.list[i]) + ", " + getForecastTemp(forecast.list[i]) + "°C<br>";
                    } else if(date.getDate() == (day1 + 2)) {
                        if(forecast.list[i].main.temp_max > max_temps[2])
                            max_temps[2] = forecast.list[i].main.temp_max;
                        if(forecast.list[i].main.temp_min < min_temps[2])
                            min_temps[2] = forecast.list[i].main.temp_min;
                        days[2] = new Date(forecast.list[i].dt_txt).getDay();
                        var hours = date.getHours();
                        var minutes = date.getMinutes();
                        if (hours <= 9)
                            hours = "0" + hours;
                        if (minutes <= 9)
                            minutes = "0" + minutes;
                        details[2] += hours + ":" + minutes + " - " + getForecastStatus(forecast.list[i]) + ", " + getForecastTemp(forecast.list[i]) + "°C<br>";
                    } else if(date.getDate() == (day1 + 3)) {
                        if(forecast.list[i].main.temp_max > max_temps[3])
                            max_temps[3] = forecast.list[i].main.temp_max;
                        if(forecast.list[i].main.temp_min < min_temps[3])
                            min_temps[3] = forecast.list[i].main.temp_min;
                        days[3] = new Date(forecast.list[i].dt_txt).getDay();
                        var hours = date.getHours();
                        var minutes = date.getMinutes();
                        if (hours <= 9)
                            hours = "0" + hours;
                        if (minutes <= 9)
                            minutes = "0" + minutes;
                        details[3] += hours + ":" + minutes + " - " + getForecastStatus(forecast.list[i]) + ", " + getForecastTemp(forecast.list[i]) + "°C<br>";
                    } else if(date.getDate() == (day1 + 4)) {
                        if(forecast.list[i].main.temp_max > max_temps[4])
                            max_temps[4] = forecast.list[i].main.temp_max;
                        if(forecast.list[i].main.temp_min < min_temps[4])
                            min_temps[4] = forecast.list[i].main.temp_min;
                        days[4] = new Date(forecast.list[i].dt_txt).getDay();
                        var hours = date.getHours();
                        var minutes = date.getMinutes();
                        if (hours <= 9)
                            hours = "0" + hours;
                        if (minutes <= 9)
                            minutes = "0" + minutes;
                        details[4] += hours + ":" + minutes + " - " + getForecastStatus(forecast.list[i]) + ", " + getForecastTemp(forecast.list[i]) + "°C<br>";
                    }
                }
                // Criação do texto para os primeiros 2 dias (hoje e amanhã, em que nunca muda a descrição do dia (hoje ou amanhã))
                texts[0] = "<h2 class='weather_day_label'> Today: </h2><div class='weather_day_overview'><div class='weather_day_overview_title'> Maximum temperature: </div>" + max_temps[0]+ "°C" + "<br><div class='weather_day_overview_title'> Minimum temperature: </div>" + min_temps[0] + "°C </div>";
                texts[1] = "<h2 class='weather_day_label'> Tomorrow: </h2><div class='weather_day_overview'><div class='weather_day_overview_title'> Maximum temperature: </div>" + max_temps[1]+ "°C" + "<br><div class='weather_day_overview_title'> Minimum temperature: </div>" + min_temps[1] + "°C </div>";
                // Criação do texto para cada outro dia, em função de qual o dia da semana (days[i])
                for(var i = 2; i < 5; i++) {
                    if(days[i] == 1)
                        texts[i] = "<h2 class='weather_day_label'> Monday: </h2><div class='weather_day_overview'><div class='weather_day_overview_title'> Maximum temperature: </div>" + max_temps[i]+ "°C" + "<br><div class='weather_day_overview_title'> Minimum temperature: </div>" + min_temps[i] + "°C </div>";
                    else if(days[i] == 2)
                        texts[i] = "<h2 class='weather_day_label'> Tuesday: </h2><div class='weather_day_overview'><div class='weather_day_overview_title'> Maximum temperature: </div>" + max_temps[i]+ "°C" + "<br><div class='weather_day_overview_title'> Minimum temperature: </div>" + min_temps[i] + "°C </div>";
                    else if(days[i] == 3)
                        texts[i] = "<h2 class='weather_day_label'> Wednesday: </h2><div class='weather_day_overview'><div class='weather_day_overview_title'> Maximum temperature: </div>" + max_temps[i]+ "°C" + "<br><div class='weather_day_overview_title'> Minimum temperature: </div>" + min_temps[i] + "°C </div>";
                    else if(days[i] == 4)
                        texts[i] = "<h2 class='weather_day_label'> Thursday: </h2><div class='weather_day_overview'><div class='weather_day_overview_title'> Maximum temperature: </div>" + max_temps[i]+ "°C" + "<br><div class='weather_day_overview_title'> Minimum temperature: </div>" + min_temps[i] + "°C </div>";
                    else if(days[i] == 5)
                        texts[i] = "<h2 class='weather_day_label'> Friday: </h2><div class='weather_day_overview'><div class='weather_day_overview_title'> Maximum temperature: </div>" + max_temps[i]+ "°C" + "<br><div class='weather_day_overview_title'> Minimum temperature: </div>" + min_temps[i] + "°C </div>";
                    else if(days[i] == 6)
                        texts[i] = "<h2 class='weather_day_label'> Saturday: </h2><div class='weather_day_overview'><div class='weather_day_overview_title'> Maximum temperature: </div>" + max_temps[i]+ "°C" + "<br><div class='weather_day_overview_title'> Minimum temperature: </div>" + min_temps[i] + "°C </div>";
                    else
                        texts[i] = "<h2 class='weather_day_label'> Sunday: </h2><div class='weather_day_overview'><div class='weather_day_overview_title'> Maximum temperature: </div>" + max_temps[i]+ "°C" + "<br><div class='weather_day_overview_title'> Minimum temperature: </div>" + min_temps[i] + "°C </div>";
                }

                // Função responsável por mostrar as previsões detalhadas do dia
                function expandDay(day) {
                    document.getElementById("day" + day).innerHTML = texts[day - 1] + "<br><button onClick='unexpandDay(" + (day) + ")'> Hide </button><br><br><div class='weather_day_details'> " + details[day - 1] + " </div>";
                }

                // Função responsável por ocultar as previsões (volta ao estado inicial)
                function unexpandDay(day) {
                    document.getElementById("day" + day).innerHTML = texts[day - 1] + "<br><button onClick='expandDay(" + (day) + ")'> Details </button>";
                }

                // Criação inicial do conteúdo de cada dia
                for(var i = 0 ; i < 5; i ++) {
                    document.getElementById("day" + (i + 1)).innerHTML = texts[i] + "<br><button onClick='expandDay(" + (i+1) + ")'> Details </button>";
                }
            </script>
        </section>
        <!-- Fundo da página que contém dados do desenvolvedor -->
        <footer>
            Developed by Carlos Tojal<br>
            <div class="contacts">
                GitHub: <a href="https://github.com/carlostojal" target="blank">carlostojal</a><br>
                Email: <a href="mailto:carlos.tojal@hotmail.com" target="blank">carlos.tojal@hotmail.com</a>
            </div><br>
            <div class="copyright">Copyright © Carlos Tojal (2019)</div>
        </footer>
    </body>
</html>